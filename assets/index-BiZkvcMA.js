(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))c(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&c(a)}).observe(document,{childList:!0,subtree:!0});function n(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function c(t){if(t.ep)return;t.ep=!0;const o=n(t);fetch(t.href,o)}})();function _(){const r=document.getElementById("cardsContainer"),e=document.getElementById("deleteButton");if(r.children.length>0){if(!e){const n=document.createElement("button");n.textContent="Supprimer",n.className="delete-button",n.id="deleteButton",n.addEventListener("click",()=>{r.innerHTML="",localStorage.removeItem(`weather_${document.getElementById("inputCity").value}_${document.getElementById("inputCountry").value}`),n.remove()});const c=document.getElementById("button");c.parentNode.insertBefore(n,c.nextSibling)}}else e&&e.remove()}async function O(r){const e=[],n=[];return r.list.forEach(c=>{e.push(c.dt_txt),n.push(c.main.temp)}),console.log(),[e,n]}async function $(r){const e=document.getElementById("cardsContainer"),n={},c=document.getElementById("inputCity").value,t=document.getElementById("inputCountry").value,o=`weather_${c}_${t}`;r.list.forEach(u=>{const i=u.dt_txt.split(" ")[0];n[i]||(n[i]=[]),n[i].push(u)}),localStorage.setItem(o,JSON.stringify(r));for(const[u,i]of Object.entries(n)){const d=document.createElement("div");d.className="weather-card";const w=document.getElementById("inputCity");d.textContent=w.value;const b=new Date(u),v={weekday:"long",year:"numeric",month:"long",day:"numeric"},B=b.toLocaleDateString("fr-FR",v),p=document.createElement("div");p.className="card-header",p.textContent=B,d.appendChild(p);const y=document.createElement("div");y.className="card-content",i.forEach(l=>{const I=l.dt_txt.split(" ")[1].substring(0,5),N=Math.round(l.main.temp)+"°C",S=`https://openweathermap.org/img/wn/${l.weather[0].icon}.png`,x=l.weather[0].description,L=Math.round(l.pop*100)+"%",s=document.createElement("div");s.className="forecast-item";const f=document.createElement("span");f.className="forecast-time",f.textContent=I,s.appendChild(f);const m=document.createElement("img");m.src=S,m.alt=x,m.className="forecast-icon",s.appendChild(m);const h=document.createElement("span");h.className="forecast-pop",h.textContent=L,s.appendChild(h);const g=document.createElement("span");g.className="forecast-temp",g.textContent=N,s.appendChild(g),y.appendChild(s)}),d.appendChild(y),e.appendChild(d)}const a=document.createElement("canvas");a.className="card-ctx",e.appendChild(a);const C=await O(r);new Chart(a.getContext("2d"),{type:"line",data:{labels:C[0],datasets:[{label:"Température",data:C[1],borderWidth:3}]},options:{scales:{y:{beginAtZero:!0}}}});const E=document.createElement("hr");E.className="hr",e.appendChild(E)}function A(r,e){const n=`weather_${r}_${e}`,c=localStorage.getItem(n);return c?JSON.parse(c):null}async function D(r,e){const c=`https://api.openweathermap.org/data/2.5/forecast?q=${r},${e}&units=metric&appid=f991500a4a21e2e0d0db89742328ee6a`;try{if(typeof r!="string")throw new Error("Erreur réseau");const t=await fetch(c);if(!t.ok)throw new Error("Erreur réseau");const o=await t.json();if(o.length===0)throw new Error("Not at city");return o}catch(t){console.error("Problème :",t)}}function K(){document.getElementById("button").addEventListener("click",async()=>{const e=document.getElementById("inputCity"),n=document.getElementById("inputCountry"),c=e.value,t=n.value;let o=A(c,t);o||(o=await D(c,t)),await $(o),_()})}K();function M(){const r=[];for(let e=0;e<localStorage.length;e++){const n=localStorage.key(e);n&&n.startsWith("weather_")&&r.push(n)}if(r.length>0){const e=r[r.length-1],[n,c,t]=e.split("_"),o=document.getElementById("inputCity"),a=document.getElementById("inputCountry");o&&a&&(o.value=c,a.value=t,document.getElementById("button").click())}}document.addEventListener("DOMContentLoaded",M);
